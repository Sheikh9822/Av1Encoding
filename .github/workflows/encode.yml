name: Encode and Send

on:
  workflow_dispatch:
    inputs:
      video_url:
        description: 'Direct Index Link'
        required: true
      custom_name:
        description: 'Formatted Name from HF Bot'
        required: true

jobs:
  encode:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
      - uses: actions/checkout@v4

      - name: ðŸ›  Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg
          pip install pyrogram tgcrypto

      - name: ðŸ“¥ Download Source
        run: |
          curl -L --retry 5 --retry-delay 5 \
          -o "source.mkv" \
          "${{ github.event.inputs.video_url }}"

      - name: ðŸš€ Encode + Upload with Telegram Progress
        env:
          API_ID: ${{ secrets.TG_API_ID }}
          API_HASH: ${{ secrets.TG_API_HASH }}
          BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TG_CHAT_ID }}
          FILE_NAME: "${{ github.event.inputs.custom_name }}.mkv"
        run: python uploader.py
